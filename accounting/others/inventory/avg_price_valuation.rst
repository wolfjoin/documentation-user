==========================================================
产品退货时使用移动平均计算成本
==========================================================

作为 `*inventory valuation
page* <https://www.odoo.com/documentation/functional/valuation.html>`__ 状态,
一个可能的成本方式是你可以使用永恒的库存成本估值方式, 平均成本。

本文档能解决一个经常性的问题, 使用这种方法使他们的库存估价 : 
退还给供应商的货将如何影响平均成本和会计凭证吗? 本文档 **只** 具体定义了永恒估值
(而不是周期性)和平均价格成本核算方法(而不是标准的FIFO)。

平均成本的定义
==========================

平均成本法, 在计算期末存货和销货成本的基础上, 计算存货的加权平均单位成本。

加权平均单位成本计算使用以下公式 :

- 新产品到达仓库时, 重新计算新的平均成本为 :

.. image:: media/avg01.png
   :align: center

- 当产品离开仓库 :平均成本 不 变化

定义采购价格
---------------------------

购买价格是接收产品时的暂估 (您可能没有收到供应商发票)和评估单据。
购买价格包括支付产品成本, 但它也可能包括额外的成本, 像到岸成本。

平均成本示例
====================

+-----------------------------+---------------+-------------------+---------------+------------+
| Operation                   | Delta Value   | Inventory Value   | Qty On Hand   | Avg Cost   |
+=============================+===============+===================+===============+============+
|                             |               | $0                | 0             | $0         |
+-----------------------------+---------------+-------------------+---------------+------------+
| Receive 8 Products at $10   | +8\*$10       | $80               | 8             | $10        |
+-----------------------------+---------------+-------------------+---------------+------------+
| Receive 4 Products at $16   | +4\*$16       | $144              | 12            | $12        |
+-----------------------------+---------------+-------------------+---------------+------------+
| Deliver 10 Products         | -10\*$12      | $24               | 2             | $12        |
+-----------------------------+---------------+-------------------+---------------+------------+
+-----------------------------+---------------+-------------------+---------------+------------+

起初, 平均成本设置为0, 因为产品没有库存. 当收到第一个货时, 平均成本成为逻辑上购买价格。

在接收第二单货时, 平均成本更新, 因为库存总额现在 ``$80 + 4*$16 = $144``. 
我们手头有12件, 平均价格每单位是 ``$144 / 12 = $12``.

根据定义, 交付的10个产品并不改变平均成本。
的确, 现在库存价值24美元, 因为我们只剩下2件, 每件为“ ``$24 / 2 = $12``.

采购退货使用案例
========================

如果收到货后退货, 将使用平均成本公式减少库存成本(不是在这些产品的最初价格!)。

意味着以上表格将会按照如下更新 :

+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Operation                                     | Delta Value   | Inventory Value   | Qty On Hand   | Avg Cost   |
+===============================================+===============+===================+===============+============+
|                                               |               | $24               | 2             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Return of 1 Product initially bought at $10   | -1\*$12       | $12               | 1             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+

解释：计数器示例
----------------------------

记得 **平均成本** 的定义, 说出库时不更新产品的平均成本。
如果你打破这个规则, 你可能会导致库存不一致。

作为一个例子, 当你向客户交货并退货给供应商(购买的成本)。这是操作 :

+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Operation                                     | Delta Value   | Inventory Value   | Qty On Hand   | Avg Cost   |
+===============================================+===============+===================+===============+============+
|                                               |               | $24               | 2             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Customer Shipping 1 product                   | -1\*$12       | $12               | 1             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Return of 1 Product initially bought at $10   | -1\*$10       | **$2**            | **0**         | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+

正如你所看到的在这个例子中, 这是不正确的 :0件产品2美元的存货估价在仓库里。

正确的场景应该是返回货物目前的平均成本 :

+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Operation                                     | Delta Value   | Inventory Value   | Qty On Hand   | Avg Cost   |
+===============================================+===============+===================+===============+============+
|                                               |               | $24               | 2             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Customer Shipping 1 product                   | -1\*$12       | $12               | 1             | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+
| Return of 1 Product initially bought at $10   | -1\*$12       | **$0**            | **0**         | $12        |
+-----------------------------------------------+---------------+-------------------+---------------+------------+

另一方面, 利用平均成本估值退货, 确保正确的库存价值。

anglo saxon 模式的深究
------------------------------------

人们在使用 **anglo saxon accounting** 会计原则, 还有另一个概念需考虑 :
产品的入库科目, 这是为了保存收票时的价值。所以这个账户在收货时会增加, 收到发票时会减少.

回到我们的例子中, 我们看到, 当退货时按平均价格, 输入的价格是原购买价格 :

+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Operation                                     | stock input   | price diff   | Inventory Value   | Qty On Hand   | Avg Cost   |
+===============================================+===============+==============+===================+===============+============+
|                                               |               |              | $0                | 0             | $0         |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Receive 8 Products at $10                     | ($80)         |              | $80               | 8             | $10        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Receive vendor bill $80                       | $0            |              | $80               | 8             | $10        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Receive 4 Products at $16                     | ($64)         |              | $144              | 12            | $12        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Receive vendor bill $64                       | $0            |              | $144              | 12            | $12        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Deliver 10 Products                           | $0            |              | $24               | 2             | $12        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Return of 1 Product initially bought at $10   | **$10**       | **$2**       | **$12**           | 1             | $12        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+
| Receive vendor refund $10                     | $0            | $2           | $12               | 1             | $12        |
+-----------------------------------------------+---------------+--------------+-------------------+---------------+------------+

供应商退款将使用原始的购买价格, 所以退货时会零差异, 我们需要重用原来的价格。
产品类别上的价格差异, 用于记录平均成本和原购买价格之间的差异。

这里出库原则，是先进后出
